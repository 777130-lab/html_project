<!DOCTYPE html>

<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>Пример html</title>
    <link rel="stylesheet" href="style_h.css">
</head>
<body>
    <hr>
    <div><h1><b>Функции PHP для работы с MySQL/MySQLi. Примеры запросов.</b></h1></div>
    <hr>
    <section>
        <div class="content">
            <div class=title_content><h2>Содержание</h2></div>
            <div class="list_content">
                <ol>
                    <li><a href="#1">Что такое база данных</a></li>
                    <li><a href="#2">MySQL</a></li>
                    <li><a href="#3">Что такое PHP</a></li>
                    <li><a href="#4">Что такое MySQLi</a></li>
                    <li><a href="#5">Как выглядит работа с базой данных</a></li>
                    <li><a href="#6">Функция mysqli_connect():соединение с MySQL</a></li>
                    <li><a href="#7">Проверка соединения</a></li>
                    <li><a href="#8">Установка кодировки</a></li>
                    <li><a href="#9">Выполнение запросов</a></li>
                    <li><a href="#10">Добавление записи</a></li>
                    <li><a href="#11">Функция mysqli_insert_id:получение идентификатора добавленной записи</a></li>
                    <li><a href="#12">Чтение записей</a></li>
                    <li><a href="#13">Как получить сразу все записи в виде двумерного массива</a></li>
                    <li><a href="#14">Как узнать количество записей</a></li>
                </ol>
            </div>
        </div>
    </section>
    <hr>
    <section>
        <h2 id="1"><b>Что такое база данных</b></h2>
        <div class="text">
            <div><b>База данных</b> - это место, в котором хранятся данные сайта. Это могут быть тексты страниц, списки пользователей с их логинами и паролями, каталоги продукции и другое.</div>
            <div>База данных состоит из <b>таблиц</b>. Что такое таблица вы знаете из жизни: это строки и столбцы. А на пересечении строк и столбцов располагаются ячейки.</div>
            <div>В базах данных столбцы часто называют полями.</div>
            <div>Это легко можно вообразить себе, представив документ Excel. Базой данных будет являться сам документ (книга), а таблицами - каждый лист этой книги.</div>
        </div>
        <hr>
        <h2 id="2"><b>MySQL</b></h2>
        <div class="text">
            <div><b>Язык структурированных запросов (Structured Query Language, SQL)</b> – самый распространенный язык, предназначенный для записи, извлечения, обновления и удаления информации в системах управления реляционными базами данных. Реляционная означает, что база данных соответствует реляционной модели, и относится к схеме и принципам хранения данных. Схема описывает структуру хранимых данных.</div>
            <div>Реляционная база данных представляет собой набор таблиц, однако достаточно часто в состав базы данных входят и другие элементы, позволяющие дополнительно влиять на организацию и структуру данных в соответствии с определенным набором требований.</div>
            <div><b>MySQL</b> – это полнофункциональная свободно распространяемая система управления реляционными базами данных. MySQL начали разрабатывать в 1990-х годах, поскольку потребность в разумном управлении компьютерной информацией постоянно росла. Разработчики ядра MySQL пытались решить эту проблему с помощью маленькой и простой базы данных mSQL. Когда выяснилось, что mSQL не справляется со всеми задачами, которые создателям хотелось на нее возложить, они создали более мощную базу данных, которая превратилась в MySQL.</div>
            <div>MySQL поддерживает несколько различных <b>механизмов базы данных (database engines)</b>.</div>
            <div>Механизмы базы данных определяют, как MySQL в данный момент обрабатывает хранение и извлечение данных. Как следствие, каждый механизм хранения обладает собственным набором возможностей и преимуществ. </div>
        </div>
        <hr>
        <h2 id="3"><b>Что такое PHP</b></h2>
        <div class="text">
            <div>PHP поддерживает работу с базой данных MySQL.</div>
            <div>Специальные встроенные функции для работы с MySQL позволяют просто и эффективно работать с этой СУБД: выполнять любые запросы, читать и записывать данные, обрабатывать ошибки.</div>
            <div>Сценарий, который подключается к БД, выполняет запрос и показывает результат, будет состоять всего из нескольких строк. Для работы с MySQL не надо ничего дополнительно устанавливать и настраивать; всё необходимое уже доступно вместе со стандартной поставкой PHP.</div>
        </div>
        <hr>
        <h2 id="4"><b>Что такое MySQLi</b></h2>
        <div class="text">
            <div><b>MySQLi (MySQL Improved)</b> — это расширение PHP, которое добавляет в язык полную поддержку баз данных MySQL. Это расширение поддерживает множество возможностей современных версий MySQL.</div>
        </div>
        <hr>
        <h2 id="5"><b>Как выглядит работа с базой данных</b></h2>
        <div class="text">
            <div>Типичный процесс работы с СУБД в PHP-сценарии состоит из нескольких шагов:</div>
            <ol>
                <li>Установить подключение к серверу СУБД, передав необходимые параметры: адрес, логин, пароль.</li>
                <li>Убедиться, что подключение прошло успешно: сервер СУБД доступен, логин и пароль верные и так далее.</li>
                <li>Сформировать правильный SQL запрос (например, на чтение данных из таблицы).</li>
                <li>Убедиться, что запрос был выполнен успешно.</li>
                <li>Получить результат от СУБД в виде массива из записей.</li>
                <li>Использовать полученные записи в своём сценарии (например, показать их в виде таблицы).</li>
            </ol>
        </div>
        <hr>
        <h2 id="6"><b>Функция <i>mysqli_connect()</i> соединение с MySQL</b></h2>
        <div class="text">
            <div>Перед началом работы с данными внутри MySQL, нужно открыть соединение с сервером СУБД.</div>
            <div>В PHP это делается с помощью стандартной функции <b><i>mysqli_connect()</i></b>. Функция возвращает результат — ресурс соединения. Данный ресурс используется для всех следующих операций с MySQL.</div>
            <div>Но чтобы выполнить соединение с сервером, необходимо знать как минимум три параметра:</div>
            <ul>
                <li>Адрес сервера СУБД;</li>
                <li>Логин;</li>
                <li>Пароль.</li>
            </ul>
            <div>Если вы следовали стандартной процедуре установки MySQL или используете OpenServer, то адресом сервера будет <i>localhost</i>, логином — <i>root</i>. При использовании OpenServer пароль для подключения — это пустая строка ‘’, а при самостоятельной установке MySQL пароль вы задавали в одном из шагов мастера установки.</div>
            <div>Базовый синтаксис функции <b><i>mysqli_connect()</i></b>:</div>
            <div class="pic"><img src="pic/pic1.png"></div>
        </div>
        <hr>
        <h2 id="7"><b>Проверка соединения</b></h2>
        <div class="text">
            <div>Первое, что нужно сделать после соединения с СУБД — это выполнить проверку, что оно было успешным.</div>
            <div>Эта проверка нужна, чтобы исключить ошибку при подключении к БД. Неверные параметры подключения, неправильная настройка или высокая нагрузка заставит MySQL отвергать новые подключения. Все эти ситуации приведут к невозможности соединения, поэтому программист должен проверить успешность подключения к серверу, прежде чем выполнять следующие действия.</div>
            <div>Соединение с MySQL устанавливается один раз в сценарии, а затем используется при всех запросах к БД.</div>
            <div>Результатом выполнения функции <i>mysqli_connect()</i> будет значение специального типа — ресурс.</div>
            <div>Если подключение к MySQL не удалось, то функция <i>mysqli_connect()</i> вместо ресурса вернет логическое значение типа «ложь» — false.</div>
            <div>Хорошей практикой будет всегда проверять значение результата выполнения этой функции и сравнивать его с ложью.</div>
            <div>Соединение с MySQL и проверка на ошибки:</div>
            <div class="pic"><img src="pic/pic2.png" /></div>
            <div>Функция <b><i>mysqli_connect_error()</i></b> просто возвращает текстовое описание последней ошибки MySQL.</div>
        </div>
        <hr>
        <h2 id="8"><b>Установка кодировки</b></h2>
        <div class="text">
            <div>Первым делом после установки соединения крайне желательно явно задать кодировку, которая будет использоваться при обмене данными с MySQL. Если этого не сделать, то вместо записей со значениями, написанными кириллицей, можно получить последовательность из знаков вопроса: ‘?????????????????’.</div>
            <div>Сразу после успешной установки соединения вызовите функцию:<b><i>mysqli_set_charset($con, "utf8")</i></b></div>
        </div>
        <hr>
        <h2 id="9"><b>Выполнение запросов</b></h2>
        <div class="text">
            <div>Установив соединение и определив кодировку, мы готовы выполнить свои первые SQL-запросы. Вы уже умеете составлять корректные SQL команды и выполнять их через консольный или визуальный интерфейс MySQL-клиента.</div>
            <div>Те же самые запросы можно отправлять без изменений и из PHP-сценария. Помогут в этом несколько встроенных функций языка.</div>
            <div><b><i>Два вида запросов</i></b></div>
            <div>Следует разделять все SQL-запросы на две группы:</div>
            <ul>
                <li>Чтение информации (SELECT);</li>
                <li>Модификация (UPDATE,DELETE,INSERT).</li>
            </ul>
            <div>При выполнении запросов из среды PHP, запросы из второй группы возвращают только результат их исполнения: успех или ошибку.</div>
            <div>Запросы первой группы при успешном выполнении возвращают специальный ресурс результата. Его, в свою очередь, можно преобразовать в ассоциативный массив (если нужна одна запись) или в двумерный массив (если требуется список записей).</div>
        </div>
        <hr>
        <h2 id="10"><b>Добавление записи</b></h2>
        <div class="text">
            <div>Пусть у нас есть проект — дневник наблюдений за погодой. Начнём практическую работу с заполнения таблиц данными. Для начала добавим хотя бы один город в таблицу cities.</div>
            <div>Выражение INSERT INTO используется для добавления новых записей в таблицу базы данных.</div>
            <div>Составим корректный SQL-запрос на вставку записи с именем города, а затем выполним его путём передачи этого запроса в функцию <b><i>mysqli_query()</i></b>, чтобы добавить новые данные в таблицу.</div>
            <div class="pic"><img src="pic/pic3.png"></div>
            <div>Обратите внимание, что первым параметром для функциии <b><i>mysqli_query()</i></b> передаётся ресурс подключения, полученный от функции <i>mysqli_connect()</i>, вторым параметром следует строка с SQL-запросом.</div>
            <div>При запросах на изменение данных (не SELECT) результатом выполнения будет логическое значение — true или false.</div>
            <div>false будет означать, что запрос выполнить не удалось. Для получения строки с описанием ошибки существует функция <b><i>mysqli_error($link)</i></b>.</div>
        </div>
        <hr>
        <h2 id="11"><b>Функция mysqli_insert_id:получение идентификатора добавленной записи</b></h2>
        <div class="text">
            <div>Следующим шагом будет добавление погодной записи для нового города.</div>
            <div>Погодные записи хранит таблица weather_log, но, чтобы сослаться на город, необходимо знать идентификатор записи из таблицы cities.</div>
            <div>Здесь пригодится функция <b><i>mysqli_insert_id()</i></b>.</div>
            <div>Она принимает единственный аргумент — ресурс соединения, а возвращает идентификатор последней добавленной записи.</div>
            <div>Теперь у нас есть всё необходимое, чтобы добавить погодную запись.</div>
            <div>Вот как будет выглядеть комплексный пример с подключением к MySQL и добавлением двух новых записей:</div>
            <div class="pic"><img src="pic/pic4.png"></div>
        </div>
        <hr>
        <h2 id="12"><b>Чтение записей</b></h2>
        <div class="text">
            <div>Другая частая операция при работе с базами данных в PHP — это получение записей из таблиц (запросы типа SELECT).</div>
            <div>Составим SQL-запрос, который будет использовать SELECT выражение. Затем выполним этот запрос с помощью функции <i>mysqli_query()</i>, чтобы получить данные из таблицы.</div>
            <div>В этом примере показано, как вывести все существующие города из таблицы cities:</div>
            <div class="pic"><img src="pic/pic5.png"></div>
            <div>В примере выше результат выполнения функции <i>mysqli_query()</i> сохранён в переменной $result.</div>
            <div>Важно понимать, что в этой переменной находятся не данные из таблицы, а специальный тип данных — так называемая ссылка на результаты запроса.</div>
            <div>Чтобы получить действительные данные, то есть записи из таблицы, следует использовать другую функцию — <b><i>mysqli_fetch_array()</i></b> — и передать ей единственным параметром эту самую ссылку.</div>
            <div>Теперь каждый вызов функции <i>mysqli_fetch_array()</i> будет возвращать следующую запись из всего результирующего набора записей в виде ассоциативного массива.</div>
            <div>Цикл while здесь используется для «прохода» по всем записям из полученного набора записей.</div>
            <div>Значение поля каждой записи можно узнать просто обратившись по ключу этого ассоциативного массива.</div>
        </div>
        <hr>
        <h2 id="13"><b>Как получить сразу все записи в виде двумерного массива</b></h2>
        <div class="text">
            <div>Иногда бывает удобно после запроса на чтение не вызывать в цикле <i>mysqli_fetch_array</i> для извлечения очередной записи по порядку, а получить их сразу все одним вызовом. PHP так тоже умеет. Функция <b><i>mysqli_fetch_all($res, MYSQLI_ASSOC)</i></b> вернёт двумерный массив со всеми записями из результата последнего запроса.</div>
            <div>Перепишем пример с показом существующих городов с её использованием:</div>
            <div class="pic"><img src="pic/pic6.png"></div>
        </div>
        <hr>
        <h2 id="14"><b>Как узнать количество записей</b></h2>
        <div class="text">
            <div>Часто бывает необходимо узнать, сколько всего записей вернёт выполненный SQL запрос.</div>
            <div>Это может помочь при организации постраничной навигации, или просто в качестве информации.</div>
            <div>Узнать число записей поможет функция <b><i>mysqli_num_rows()</i></b>, которой следует передать ссылку на результат запроса.</div>
            <div class="pic"><img src="pic/pic7.png"></div>
        </div>
        <hr>
    </section>
    <section>
        <div class="liter">
            <h3>Список использованной литературы</h3>
            <div><a href="https://htmlacademy.ru/tutorial/php/mysql">https://htmlacademy.ru</a></div>
            <div><a href="https://skillbox.ru/media/code/dlya_chego_ispolzuyut_php/">https://skillbox.ru</a></div>
            <div><a href="https://addphp.ru/materials/mysql/1_4.php">https://addphp.ru</a></div>
        </div>
    </section>
</body>
</html>

